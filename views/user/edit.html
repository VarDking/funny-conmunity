<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title><%= title + '-' + config.title %></title>
    <meta name="description" content="<%= config.description %>" />
    <meta name="keywords" content="<%= config.keywords %>" />
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no,width=device-width">
    <meta name="format-detection" content="telephone=no" />

    <link rel="stylesheet" type="text/css" href="/public/css/default.css">
    <link rel="stylesheet" type="text/css" href="/public/css/header.css">
    <link rel="stylesheet" type="text/css" href="/public/css/edit.css">
    <link rel="stylesheet" type="text/css" href="/public/css/footer.css">
    <link rel="stylesheet" type="text/css" href="/public/css/head_phone.css">

    <script src="http://apps.bdimg.com/libs/jquery/1.8.3/jquery.min.js" type="text/javascript"></script>
    <script src="/public/js/hint.js" type="text/javascript"></script>
    <script src="/public/js/api.js" type="text/javascript"></script>
    <script src="/public/js/head_phone.js" type="text/javascript"></script>
</head>
<body>
<%- include('../header.html', {user: user}) %>

<div class="edit">
    <div class="content clearfix">
        <div class="edit-head">
            个人资料
        </div>
        <div class="edit-form clearfix">
            <div class="avatar clearfix">
                <form id="form-img" action="/api/user/avatar" method="post" target="iframe-img" enctype="multipart/form-data">
                    <input id="avatar" name="avatar" type="file">
                    <iframe style="display: none;" id="iframe-img" name="iframe-img" ></iframe>
                </form>
                <img class="avatar-img" src="<%= user.info.avatar %>" alt="">
            </div>
            <div class="info">
                <div class="group">
                    <p class="title">个性签名： </p>
                    <input class="description" type="text" placeholder="个性签名"  value="<%= user.info.description %>">
                </div>
                <div class="group community" style="margin-right: 40px">
                    <p class="title">QQ空间：</p>
                    <input class="qq" type="text" placeholder="QQ号或链接"  value="<%= user.info.qq %>">
                </div>
                <div class="group community">
                    <p class="title">微博：</p>
                    <input class="wb" type="text" placeholder="微博主页链接"  value="<%= user.info.wb %>">
                </div>
                <div class="group">
                    <p class="title">用户名：<span style="color: #ffcdcd;">不可修改</span></p>
                    <input class="loginname" readonly="readonly" type="text" placeholder="用户名" value="<%= user.info.loginname %>">
                </div>
                <div class="group">
                    <p class="title">邮箱号： <span style="color: #ffcdcd;">不可修改</span></p>
                    <input class="email" readonly="readonly" type="email"  placeholder="验证邮箱"  value="<%= user.info.email %>">
                </div>
                <div style="clear: both;"></div>
                <div class="group clearfix" style="float: right;">
                    <div class="btn finish">更新</div>
                    <div class="btn cancel">取消</div>
                </div>
            </div>
            
        </div>
    </div>
</div>

<%- include('../footer.html') %>
<script type="text/javascript">
    $('.finish').on('click', function () {
    	var $this = $(this);
    	var description = $('.description').val();
    	var qq = $('.qq').val();
    	var wb = $('.wb').val();

		if (description.length > 150) {
			hint('描述有点长，只能在150个字符以内');
			return;
		}
		if (qq.length > 100 || wb.length > 100) {
			hint('链接长度过长');
			return;
        }
		var data = 'description=' + description + '&qq=' + qq + '&wb=' + wb;
        $this.html('<div class="spinner"><div class="bounce1"></div><div class="bounce2"></div><div class="bounce3"></div></div>');
        $.ajax({
            type: 'post',
            url : '/api/user/edit',
            data: data,
            success: function (msg) {
            	hint(msg.hint);
				$this.html('更新');
            }
        })
    });


    uploadAvatar($('#avatar'), $('.avatar-img'));


//	// 上传图片
//	$('#avatar').on('change', function () {
//		if (this.files !== undefined) {
//			var file = this.files[0];
//			var type = ['image/png','image/jpeg','image/gif'];
//
//			if (file.size > 1024 * 1024) {
//				hint('头像大小不能超过1M');
//				return;
//			}
//			if (type.indexOf(file.type) === -1) {
//				hint('头像只能为 jpg, png, gif格式');
//				return;
//			}
//		}
//		var iframeAvatar = document.getElementById('iframe-avatar');
//		$('#form-avatar').submit();
//		var url = '';
//
//		var time = setInterval(function () {
//			url = iframeAvatar.contentWindow.window.location.href;
//			if (url.indexOf('uploadredirect') !== -1) {
//				clearInterval(time);
//				parseUrl(url);
//			}
//		}, 100)
//	});
//
//	function parseUrl(url) {
//		var prefix = 'uploadredirect/';
//		url = url.substring(url.indexOf(prefix) + prefix.length);
//		url = url.split('/');
//		if (url.length !== 3) {
//			hint('头像上传错误');
//			return;
//		}
//		url[1] = decodeURIComponent(url[1]);
//		if (url[0] < 1) {
//			hint(url[1]);
//			return;
//		}
//		if (url[0] > 0) {
//			hint(url[1]);
//			$('.avatar-img').attr('src', '/avatar/temp/' + url[2]);
//		}
//	}
</script>
</body>
</html>
