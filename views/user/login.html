<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no,width=device-width">
    <meta name="format-detection" content="telephone=no" />

    <link rel="stylesheet" type="text/css" href="/public/css/default.css">
    <link rel="stylesheet" type="text/css" href="/public/css/header.css">
    <link rel="stylesheet" type="text/css" href="/public/css/user_new.css">
    <link rel="stylesheet" type="text/css" href="/public/css/head_phone.css">
    <link rel="stylesheet" type="text/css" href="/public/css/footer.css">

    <script src="http://apps.bdimg.com/libs/jquery/1.8.3/jquery.min.js" type="text/javascript"></script>
    <script src="http://cdn.bootcss.com/blueimp-md5/1.1.0/js/md5.min.js" type="text/javascript"></script>
    <script src="/public/js/hint.js" type="text/javascript"></script>
    <script src="/public/js/head_phone.js" type="text/javascript"></script>
</head>
<body>
<%- include('../header.html', {user: user}) %>

<div id="main" style="padding-bottom: 100px">
    <p class="title iconfont">
        <span><i class=" iconfont">&#xe60f;</i>用户登录</span>
    </p>
    <div class="edit">

        <img class="avatar" src="/avatar/user_default.png" alt="" >
        <form id="new-user-form" class="clearfix" action="/api/user/login" method="post" enctype="application/x-www-form-urlencoded">
            <div class="item">
                <span><i class="iconfont" style="position:relative;top: -2px;">&#xe611;</i>请输入用户名</span>
                <input  class="loginname" name="loginname" type="text" placeholder="昵称" >
                <div class="line"></div>
            </div>
            <div class="item">
                <span><i class="iconfont">&#xe660;</i>请输入你的密码</span>
                <input class="password" name="password" type="password" placeholder="密码">
                <div class="line"></div>
            </div>
            <div class="item btn finish">登录</div>
            <a class="tologin" href="/user/new">还没有账号，马上注册</a>
            <span class="more">第三方账号登录</span>
            <div class="item login-more">
                <a class="item btn btn-quick" style="margin-right: 20px;" href="<%= 'https://api.weibo.com/oauth2/authorize?client_id=' + config.wb.ID + '&redirect_uri=' + config.wb.CALLBACK_URI + '&response_type=code&state=' + user.state_code %>"><em class="iconfont" style="color: #ff424f;">&#xe652;</em></a>
                <a class="item btn btn-quick" href="<%= 'https://graph.qq.com/oauth2.0/authorize?response_type=code&client_id=' + config.qq.ID + '&redirect_uri=' + config.qq.CALLBACK_URI + '&state=' + user.state_code %>"><em class="iconfont" style="color: #43d2f4;">&#xe607;</em></a>
            </div>

        </form>
    </div>
</div>

<%- include('../footer.html') %>
<script type="text/javascript">
    $('.more').on('click', function () {
    	this.off = !this.off;
    	$this = $(this);
    	if (this.off) {
            $('.login-more').css('display', 'block');
        } else {
			$('.login-more').css('display', 'none');
        }
    });
	$('.finish').on('click', function () {
		var loginname = $('.loginname').val();
		var password  = $('.password').val();

		if (!loginname || !password) {
			hint('请完整填写选项!');
			return;
		}
		var $This = $(this);
		$This.html('<div class="spinner"><div class="bounce1"></div><div class="bounce2"></div><div class="bounce3"></div></div>');

		var data = 'loginname=' + loginname + '&password=' + md5(password);
		$.ajax({
			type: 'POST',
			url: '/api/user/login',
			data: data,
			success: function (msg) {
				if (msg.states < 1) {
					hint(msg.hint);
					$This.html('登录');
					return;
				}
				window.location.href = '/';
			},
            error: function (XMLHttpRequest, textStatus, errorThrown) {
				$This.html('登录');
				hint('服务器开了下小差! O__O');
            }
		})
	});
</script>
</body>
</html>