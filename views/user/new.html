<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no,width=device-width">
    <meta name="format-detection" content="telephone=no" />

    <link rel="stylesheet" type="text/css" href="/public/css/default.css">
    <link rel="stylesheet" type="text/css" href="/public/css/header.css">
	<link rel="stylesheet" type="text/css" href="/public/css/user_new.css">
    <link rel="stylesheet" type="text/css" href="/public/css/footer.css">

	<script src="http://apps.bdimg.com/libs/jquery/1.8.3/jquery.min.js" type="text/javascript"></script>
	<script src="http://cdn.bootcss.com/blueimp-md5/1.1.0/js/md5.min.js" type="text/javascript"></script>
	<script src="/public/js/hint.js" type="text/javascript"></script>
</head>
<body>
<%- include('../header.html', {user: user}) %>

<div id="main">
	<p class="title iconfont">
		<span><i class=" iconfont">&#xe60f;</i>户口登记</span>
	</p>
	<div class="edit">

		<img class="avatar" src="<%= info.avatar %>" alt="" widht="100" height="100">
		<form id="new-user-form" action="/api/user/new" method="post" enctype="application/x-www-form-urlencoded">
			<div class="item">
				<i class="iconfont">&#xe611;</i>
				<input class="loginname" name="loginname" type="text" placeholder="昵称" value="<%= info.name %>">
				<div class="line"></div>
			</div>
			<div class="item">
				<i class="iconfont">&#xe60d;</i>
				<input class="description" name="description" type="text" placeholder="个性签名" value="<%= info.desc %>">
				<div class="line"></div>
			</div>
			<div class="item">
				<i class="iconfont">&#xe660;</i>
				<input class="password" name="password" type="password" placeholder="密码">
				<div class="line"></div>
			</div>
			<div class="item">
				<i class="iconfont">&#xe614;</i>
				<input class="email" name="email" type="email" placeholder="邮箱">
				<div class="line"></div>
			</div>
			<div class="item agreement">
				<i class="iconfont">&#xe698;</i>
				<span>我同意站长是最帅的</span>
			</div>
			<div class="item finish">完成注册</div>
		</form>
	</div>
</div>

<%- include('../footer.html') %>
<script type="text/javascript">
	$('.finish').on('click', function () {
		var loginname = $('.loginname').val();
		var password  = $('.password').val();
		var description = $('.description').val();
		var email = $('.email').val();

		if (!loginname || !password || !email) {
			hint('请完整填写选项!');
			return;
		}
		if (!/^(\w)+(\.\w+)*@(\w)+((\.\w+)+)$/.test(email)) {
			hint('邮箱格式不正确');
			return;
		}
		var $This = $(this);
		$This.html('<img src="/public/img/bnt_load.svg" width="60" >');
		//document.getElementById('new-user-form').submit();
		var data = 'loginname=' + loginname + '&password=' + md5(password) + '&email=' + email + '&description=' + description;
		$.ajax({
			type: 'POST',
			url: '/api/user/new',
			data: data,
			success: function (msg) {
				if (msg.states < 1) {
					hint(msg.hint);
				}
				$This.html('完成注册');
			}
		})
	});
</script>
</body>
</html>